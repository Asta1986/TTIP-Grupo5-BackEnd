<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Review.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">backend-desapp-api</a> &gt; <a href="index.source.html" class="el_package">ar.edu.unq.desapp.grupoj.backenddesappapi.model</a> &gt; <span class="el_source">Review.java</span></div><h1>Review.java</h1><pre class="source lang-java linenums">package ar.edu.unq.desapp.grupoj.backenddesappapi.model;

import ar.edu.unq.desapp.grupoj.backenddesappapi.model.user.Critic;
import ar.edu.unq.desapp.grupoj.backenddesappapi.model.user.User;
import ar.edu.unq.desapp.grupoj.backenddesappapi.service.dtos.ReviewDTO;
import jdk.jfr.Name;

import javax.persistence.*;
import java.io.Serializable;
import java.time.Instant;
import java.util.ArrayList;

import java.util.Date;
import java.util.List;

@Entity
@Table(
        name = &quot;reviews&quot;,
        uniqueConstraints = {@UniqueConstraint(columnNames = {&quot;titleId&quot;,&quot;user_id&quot;})}
)
public class Review  {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    private Integer titleId;

    private String text;
    private String textExtended;
    private Integer rating;
<span class="nc" id="L31">    private boolean spoilerAlert=false;</span>
<span class="nc" id="L32">    private Date date=Date.from(Instant.now());</span>
<span class="nc" id="L33">    private Long ratedUp=(long) 0;</span>
<span class="nc" id="L34">    private Long ratedDown= (long) 0;</span>

    @OneToOne
    protected Critic user;

    @ManyToOne(cascade = CascadeType.ALL)
    protected Language language;


<span class="nc" id="L43">    protected ReviewType type=ReviewType.NORMAL;</span>

<span class="nc" id="L45">    @OneToMany(targetEntity= ReviewRate.class, cascade = CascadeType.ALL)</span>
    @Name(&quot;reviewRates&quot;)
    private List&lt;ReviewRate&gt; reviewRates = new ArrayList&lt;&gt;();

<span class="nc" id="L49">    @OneToMany(targetEntity= ReviewReport.class, cascade = CascadeType.ALL)</span>
    @Name(&quot;reviewReports&quot;)
    private List&lt;ReviewReport&gt; reviewReports= new ArrayList&lt;&gt;();

<span class="nc" id="L53">    protected Review() {</span>
<span class="nc" id="L54">    }</span>

    public void setTitleId(Integer titleId) {
<span class="nc" id="L57">        this.titleId = titleId;</span>
<span class="nc" id="L58">    }</span>

<span class="nc" id="L60">    public Review(Integer titleId, Critic criticOrUser, String text, String textExtended, Integer rating, Boolean haveSpoiler, Language language){</span>
<span class="nc" id="L61">        this.user=criticOrUser;</span>
<span class="nc" id="L62">        this.text=text;</span>
<span class="nc" id="L63">        this.rating = rating;</span>
<span class="nc" id="L64">        this.textExtended= textExtended;</span>
<span class="nc" id="L65">        this.titleId=titleId;</span>
<span class="nc" id="L66">        this.spoilerAlert=haveSpoiler;</span>
<span class="nc" id="L67">        this.language=language;</span>

<span class="nc" id="L69">    }</span>

    public Integer getRating() {
<span class="nc" id="L72">        return rating;</span>
    }

    public Critic getUser() {
<span class="nc" id="L76">        return user;</span>
    }

    public String getText() {
<span class="nc" id="L80">        return text;</span>
    }
<span class="nc" id="L82">    public String getTextExtended() {return textExtended;}</span>
    public Integer getTitleId() {
<span class="nc" id="L84">        return titleId;</span>
    }

    public boolean getSpoilerAlert() {
<span class="nc" id="L88">        return spoilerAlert;</span>
    }

    public Date getDate() {
<span class="nc" id="L92">        return date;</span>
    }


    public Integer getId() {
<span class="nc" id="L97">        return id;</span>
    }


    public ReviewType getType() {
<span class="nc" id="L102">        return type;</span>
    }

    public Rates getReviewRate() {
<span class="nc" id="L106">        Rates rate = new Rates();</span>
<span class="nc" id="L107">        rate.ratingUp= this.ratedUp;</span>
<span class="nc" id="L108">        rate.ratingDown=this.ratedDown;</span>
<span class="nc" id="L109">        return rate;</span>
    }


    public Long getReviewRateInt(){
<span class="nc" id="L114">        return this.ratedUp-this.ratedDown;</span>
    }

    public Language getLanguage() {
<span class="nc" id="L118">        return language;</span>
    }

    public void addRate(ReviewRate reviewRate){
<span class="nc" id="L122">        reviewRates.add(reviewRate);</span>
<span class="nc" id="L123">        calculateRates();</span>

<span class="nc" id="L125">    }</span>

    public void addReport(ReviewReport reviewReport) {
<span class="nc" id="L128">        reviewReports.add(reviewReport);</span>

<span class="nc" id="L130">    }</span>

    private void calculateRates(){
<span class="nc bnc" id="L133" title="All 2 branches missed.">        this.ratedUp=  reviewRates.stream().filter(i -&gt; i.getType() == RateType.UP).count();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        this.ratedDown= reviewRates.stream().filter(i -&gt; i.getType()==RateType.DOWN).count();</span>
<span class="nc" id="L135">    }</span>

    public void setDate(Date date) {
<span class="nc" id="L138">        this.date = date;</span>
<span class="nc" id="L139">    }</span>
/*
    public ReviewDTO toDTO(Integer titleId, User user, String text, String textExtended, Integer rating, boolean spoilerAlert,Language language) {
        return new ReviewDTO(titleId, text, textExtended, rating, spoilerAlert,language);
    }
*/
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>